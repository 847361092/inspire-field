# InspireField 项目技术文档



## 技术选型

### 前端技术栈

选Vue3主要是因为熟悉，而且生态完善。配合Vite构建速度很快，开发体验不错。

- **Vue 3.5.18** - 用Composition API写起来比较舒服
- **TypeScript 5.8** - 类型提示能减少很多低级错误
- **Vite 7.0** - 启动快，热更新也快
- **Vue Router 4.5** - 路由管理
- **Pinia 3.0** - 状态管理，比Vuex简单
- **Anime.js** - 做动画用的，API友好
- **GSAP + ScrollTrigger** - 滚动效果
- **Lenis** - 平滑滚动，让页面滚动更丝滑

### 后端技术

后端比较简单，就是个上传服务器：

- **Express 4.18** - Node.js框架
- **Multer** - 处理文件上传
- **CORS** - 解决跨域问题

## 项目结构

```
inspire-field/
├── src/                      # 前端源码
│   ├── components/          # 组件目录
│   │   ├── gallery/        # 画廊相关组件
│   │   │   ├── WaterfallGrid.vue    # 瀑布流布局
│   │   │   ├── ArtworkCard.vue      # 作品卡片
│   │   │   └── HorizontalScroll.vue # 横向滚动
│   │   ├── layout/         # 布局组件
│   │   │   ├── AppHeader.vue        # 顶部导航
│   │   │   ├── HeroSection.vue      # 首页大图
│   │   │   └── SideNav.vue          # 侧边栏
│   │   ├── ui/            # UI组件
│   │   │   ├── TransitionLoader.vue # 页面过渡动画
│   │   │   ├── ThemeSwitch.vue      # 主题切换
│   │   │   └── SearchBar.vue        # 搜索框
│   │   └── upload/         # 上传组件
│   │       └── UploadModal.vue      # 上传弹窗
│   ├── views/              # 页面
│   │   ├── HomePage.vue            # 首页
│   │   └── ArtworkDetail.vue       # 作品详情页
│   ├── stores/             # 状态管理
│   │   ├── gallery.ts              # 画廊数据
│   │   └── transition.ts           # 页面过渡状态
│   ├── router/             # 路由配置
│   └── assets/styles/      # 样式文件
├── server/                  # 后端代码
│   └── upload.cjs          # 上传服务器
└── public/                  # 静态资源
    └── artworks/           # 作品存储目录
```

## 核心功能实现

### 1. 瀑布流布局

瀑布流的实现思路很简单：维护几个列，每次把新图片放到最矮的列里。

关键代码在 `WaterfallGrid.vue`：
- 根据屏幕宽度动态调整列数（2-10列）
- 计算每列高度，新图片放到最矮的列
- 给每个图片设置动画延迟，实现错开出现的效果

### 2. 页面过渡系统

这个花了不少时间调试。实现思路是：
1. 一张"纸"从上方滑下来遮住当前页面
2. 在遮住的瞬间切换路由（用户看不到切换过程）
3. 播放进度条动画
4. "纸"向下滑走，露出新页面

整个过程约3.2秒，关键是要在合适的时机切换路由，太早或太晚都会露馅。

实现在 `TransitionLoader.vue` 和 `transition.ts`。

### 3. 上传系统

上传功能比较常规：
- 前端用FormData打包文件
- 后端用Multer接收
- 按分类创建文件夹
- 重命名为 image_1.jpg、image_2.jpg 等
- 生成一个Markdown描述文件

### 4. 主题系统

支持三种主题：深色、浅色、灰色。用CSS变量实现，切换时修改根元素的 data-theme 属性。

## 性能优化

### 图片懒加载
用 IntersectionObserver 监听图片是否进入视口，进入才加载。

### 动画优化
- 只用 transform 和 opacity，避免触发重排
- 使用 will-change 提示浏览器
- 移动端简化动画，减少卡顿

### 响应式断点
根据不同屏幕宽度调整列数：
- 4K屏幕（2560px+）：7列
- 全高清（1920px）：6列  
- 标准桌面（1440px）：4列
- 平板（768-1024px）：2-3列
- 手机（<768px）：单列

## 部署说明

### 开发环境

1. 安装Node.js（要求20.19.0以上）
2. 安装依赖：`npm install`
3. 启动项目：`npm run dev:all`

### 生产部署

1. 构建前端：`npm run build`
2. 部署dist目录到静态服务器
3. 在服务器运行 `node server/upload.cjs`
4. 配置Nginx反向代理

### 端口配置

- 前端开发服务器：5173（已配置支持局域网访问）
- 上传API服务器：3001（监听0.0.0.0，支持手机访问）

需要修改的话：
- 前端端口：编辑 `vite.config.ts` 的 server.port
- 后端端口：编辑 `server/upload.cjs` 的 PORT 常量

两个服务器都配置了 host: '0.0.0.0'，所以局域网内的设备都能访问。

## 已知问题

1. **Safari兼容性**：某些动画效果在Safari上可能不流畅
2. **大文件上传**：超过50MB会被拒绝，这是故意限制的
3. **并发上传**：同时上传多个作品可能会有冲突

